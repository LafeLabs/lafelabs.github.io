<!DOCTYPE html>
<html>
<head>
<title>Geometron Panel</title>
<script src="libraries/geometronLibrary3.js">
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script id = "that">
initGeometron();
loadTable();

currentAddress = 0300;
</script>

<div id = "mainPanel">


	<textarea id = "panel1">
		
		
	</textarea>

	<div id = "panel2">
		<pre>
		<code id = "innerjsCode">
	     	
		</code>
		</pre>
	</div>
	
	<button class = "centerRow" onClick = "js2byte()">
		js2byte
	</button>
	<button class = "centerRow" onClick = "back()">
		&#x21E6;
	</button>
	<input value = "0300" id = "addressInput" onchange = "newAddress()">
	</input>
	<button class = "centerRow" onClick = "fwd()">
		&#x21E8;
	</button>
	<button class = "centerRow" onClick = "byte2js()">
		byte2js
	</button>
	
	<textarea id = "jsCode">
			
	</textarea>
	<textarea id = "byteCode">
	
	</textarea>

</div>

<script>

document.getElementById("innerjsCode").innerHTML = byteCode2string(currentTable[currentAddress]);

	document.getElementById("panel1").value = byteCode2string(currentTable[currentAddress]);


function newAddress(){
	currentAddress = parseInt(document.getElementById("addressInput").value,8);
document.getElementById("innerjsCode").innerHTML = byteCode2string(currentTable[currentAddress]);
	document.getElementById("panel1").value = byteCode2string(currentTable[currentAddress]);
}
function fwd(){
	currentAddress++;
	if(currentAddress > 0377){
		currentAddress = 0300;
	}
	document.getElementById("addressInput").value = "0" + currentAddress.toString(8);
		
	document.getElementById("innerjsCode").innerHTML = byteCode2string(currentTable[currentAddress]);
	document.getElementById("panel1").value = byteCode2string(currentTable[currentAddress]);

}	
function back(){
	currentAddress--;
	if(currentAddress < 0300){
		currentAddress = 0377;
	}
	document.getElementById("addressInput").value = "0" + currentAddress.toString(8);
	document.getElementById("innerjsCode").innerHTML = byteCode2string(currentTable[currentAddress]);
	console.log(currentTable[currentAddress]);
	document.getElementById("panel1").value = byteCode2string(currentTable[currentAddress]);
}	

function js2byte(){

	var inputCode = document.getElementById("jsCode").value;
	var array1 = inputCode.split("localCommand");
	var addressArray = [];
	array1 = array1.reverse();
	array1.pop();
	array1 = array1.reverse();
	for(var index = 0;index < array1.length;index++){
		var array2 = array1[index].split("{");
		array2 = array2.reverse();
		var foo = array2.pop();
		var bar = foo.split(")");
		foo = bar[0];
		bar = foo.split("==");
		foo = bar[1];
		foo = foo.trim();
		addressArray.push(foo);
		array2 = array2.reverse();
		array1[index] = "";
		for(var i = 0;i < array2.length-1;i++){
			array1[index] += array2[i] + "{"	
		}		
		array1[index] += array2[array2.length - 1];
	}
	for(var index = 0;index < array1.length;index++){
		var array2 = array1[index].split("}");
		array2.pop();
		array1[index] = "";
		for(var i = 0;i < array2.length-1;i++){
			array1[index] += array2[i] + "}"	
		}		
		array1[index] += array2[array2.length - 1];
	}
	for(var index = 0;index < array1.length;index++){
		currentTable[parseInt(addressArray[index],8)] = array1[index];
		array1[index]  = addressArray[index] + ":"+string2byteCode(array1[index]) + "\n"; 
	}

	document.getElementById("byteCode").value = "";
	for(var index = 0;index < array1.length;index++){
		document.getElementById("byteCode").value += array1[index];
	}

	currentAddress = parseInt(addressArray[0],8);//make the string an int
	
	document.getElementById("addressInput").value = "0" + currentAddress.toString(8);
	document.getElementById("innerjsCode").innerHTML = byteCode2string(array1[0]);
	document.getElementById("panel1").value = byteCode2string(array1[0]);

}

</script>


<style id = "mainStyle">
html {
	height: 100%;
	background: black;
	background-size: cover;
}
#mainPanel{
	width: 900px;
	height: 620px;
	padding: 10px 10px 10px 10px;
    border-style: solid;
    border-width: 5px;
    border-color: white;
    border-radius: 20px;
	background: black;	
}
#panel1{
	width: 300px;
	height: 250px;
	background: white;
	text-align: justify;
		word-wrap: break-word;

	padding: 10px 10px 10px 10px;
	margin: 10px 10px 10px 10px;
	border-radius: 10px;
}
#panel2{
	width: 500px;
	height: 250px;
	background: white;
	text-align: justify;
	word-wrap: break-word;
	padding: 10px 10px 10px 10px;
	margin: 10px 10px 10px 10px;
    border-radius: 10px;
    float:right;
}
#byteCode{
	width: 850px;
	height: 30px;
	background: white;
	text-align: justify;
	padding: 10px 10px 10px 10px;
	margin: 5px 10px 5px 10px;
	border-radius: 10px;
}

#jsCode{
	width: 850px;
	height: 30px;
	background: white;
	text-align: justify;
	padding: 10px 10px 10px 10px;
	margin: 5px 10px 5px 10px;
	border-radius: 10px;

}

#addressInput{
	font-size: 30px;
	font-style: bold;	
	width: 100px;
	height: 60px;
	background: white;
	padding: 0px 10px 0px 10px;
	margin: 10px 10px 10px 10px;
    border-radius: 10px;
	text-align: center;


}
.centerRow{
	width: 150px;
	height: 60px;
	background: white;
	font-size: 30px;
	font-style: bold;	
	padding: 10px 10px 10px 10px;
	margin: 10px 20px 10px 15px;
    border-radius: 10px;


}

h4 {
	text-align: center;
}

</style>
</body>
</html>

