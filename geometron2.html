<!DOCTYPE html>
<html>
<head>
	<title>Geometron: Geometry Based Meta-Language</title>
<script src="libraries/geometron2library.js"></script>

</head>
<body>

<script>
	initGeometron();
	backgroundImageOn = false;
	doTheThing(0507);		

</script>

<canvas id="editGlyphDisplay" width="500" height="500"style="border:1px solid;">
</canvas>
<p>

<button onClick = "rootMagic(010);">IMAGE ON/OFF</button>
<button onClick = "rootMagic(012);">PREV IMAGE</button>
<button onClick = "rootMagic(011);">NEXT IMAGE</button>
<button onClick = "rootMagic(014);">PREV GLYPH</button>
<button onClick = "rootMagic(013);">NEXT GLYPH</button>

<p>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[0],8))" id="buttoncanvas0" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[1],8))" id="buttoncanvas1" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[2],8))" id="buttoncanvas2" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[3],8))" id="buttoncanvas3" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[4],8))" id="buttoncanvas4" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[5],8))" id="buttoncanvas5" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[6],8))" id="buttoncanvas6" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[7],8))" id="buttoncanvas7" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[8],8))" id="buttoncanvas8" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[9],8))" id="buttoncanvas9" width="40" height="40"style="border:1px solid;">
</canvas>

<p>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[10],8))" id="buttoncanvas10" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[11],8))" id="buttoncanvas11" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[12],8))" id="buttoncanvas12" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[13],8))" id="buttoncanvas13" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[14],8))" id="buttoncanvas14" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[15],8))" id="buttoncanvas15" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[16],8))" id="buttoncanvas16" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[17],8))" id="buttoncanvas17" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[18],8))" id="buttoncanvas18" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[19],8))" id="buttoncanvas19" width="40" height="40"style="border:1px solid;">
</canvas>

<p>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[20],8))" id="buttoncanvas20" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[21],8))" id="buttoncanvas21" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[22],8))" id="buttoncanvas22" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[23],8))" id="buttoncanvas23" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[24],8))" id="buttoncanvas24" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[25],8))" id="buttoncanvas25" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[26],8))" id="buttoncanvas26" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[27],8))" id="buttoncanvas27" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[28],8))" id="buttoncanvas28" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[29],8))" id="buttoncanvas29" width="40" height="40"style="border:1px solid;">
</canvas>

<p>

<canvas onClick = "buttonEvent(parseInt(addressStringArray[30],8))" id="buttoncanvas30" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[31],8))" id="buttoncanvas31" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[32],8))" id="buttoncanvas32" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[33],8))" id="buttoncanvas33" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[34],8))" id="buttoncanvas34" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[35],8))" id="buttoncanvas35" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[36],8))" id="buttoncanvas36" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[37],8))" id="buttoncanvas37" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[38],8))" id="buttoncanvas38" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(parseInt(addressStringArray[39],8))" id="buttoncanvas39" width="40" height="40"style="border:1px solid;">
</canvas>


<p>
<canvas id="glyphSpellingDisplay" width="800" height="42"style="border:1px solid;">
</canvas>
<p>
<button onClick = "cursorBACK()">CURSOR BACK</button>
<button onClick = "cursorFWD()">CURSOR FWD</button>
<button onClick = "cursorDEL()">CURSOR DEL</button>
<p>
<button onClick = "buildSvg()">GRAB SVG CODE</button>
<button onClick = "exportByteCode()">EXPORT BYTE CODE</button>
<button onClick = "importByteCode()">IMPORT BYTE CODE</button>
<button onClick = "importASCII()">IMPORT ASCII</button>
<button onClick = "exportjs()">EXPORT JAVASCRIPT TABLE</button>
<p>
<textarea id = "svgText" rows="4" cols="80">
</textarea>

<script>
	redraw();
	
	
	function cursorFWD(){
	    var tempStringArray = editGlyph.split(",");
		cursorPosition++;
		if(cursorPosition > tempStringArray.length){
			cursorPosition = 0;
		}		
		redraw();
	}
	function cursorBACK(){
	    var tempStringArray = editGlyph.split(",");
		cursorPosition--;
		if(cursorPosition <0){
		 cursorPosition = tempStringArray.length;
		}	
		redraw();
	}
	function cursorDEL(){
		var tempStringArray = editGlyph.split(",");
		editGlyph = "";
		for(index =0; index < cursorPosition - 1;index++){
			editGlyph += tempStringArray[index] + ",";
		}
		for(index =cursorPosition; index < tempStringArray.length - 1;index++){
			editGlyph += tempStringArray[index] + ",";
		}
		cursorPosition--;
		redraw();

	}
	function buildSvg(){

   svgFile = [];
 //  svgFile.push("<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>");    
   svgFile.push("<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\"");
   svgFile.push("viewBox=\"0 0 600 600\" width=\"600\" height=\"600\" id=\"geometron_svg\">");     
   
   inPath = false;
   	  
   	  drawGlyph(editGlyph);

	if(inPath){  //did the glyph end in the middle of a path? if so end it here				
		svgFile.push("\"");
		svgFile.push("style=\"stroke:black;stroke-width:2\" fill=\"none\" />");
		inPath = false;
	}
  svgFile.push("</svg>");       

  
    document.getElementById("svgText").value = "";

	for(var zeep = 0;zeep < svgFile.length;zeep++){
		document.getElementById("svgText").value += svgFile[zeep];
		document.getElementById("svgText").value += "\n"
	}
}

	function exportjs(){
		var tempJSstring = "";
		for(var localAddress = tableBottom;localAddress < tableTop;localAddress++){
			tempJSstring += "	currentTable.push(\"0";
			tempJSstring += localAddress.toString(8) + ":"; 
			for(var index2 = 0;index2 < currentTable.length;index2++){
				 var localStringArray = currentTable[index2].split(":");
				 if(parseInt(localStringArray[0],8) ==  localAddress){
					tempJSstring += localStringArray[1];
				 } 
			}
			tempJSstring += "\");\n"
		}
			document.getElementById("svgText").value = tempJSstring;
	}
	
	function exportByteCode(){
		document.getElementById("svgText").value = editGlyph;
	}
	
	function importByteCode(){
		editGlyph = document.getElementById("svgText").value;
		redraw();
	}
	function importASCII(){
		asciiInput = document.getElementById("svgText").value;
		for(var index = 0;index < asciiInput.length;index++){
			editGlyph += ",0" + asciiInput.charCodeAt(index).toString(8);
		}
		cursorPosition += asciiInput.length+2;
		redraw();
	}

	function buttonEvent(localCommand){
	      	var tempCommandString = "0" + localCommand.toString(8); 
			var tempString = "";
	 		var tempStringArray = editGlyph.split(",");
	 		if(cursorPosition > tempStringArray.length){
	 			cursorPosition = tempStringArray.length;
	 		}
	 		for(var index = 0;index < cursorPosition;index++){
				tempString += tempStringArray[index];
				tempString += ",";
	 		}
			tempString += tempCommandString; 		
			tempString += ",";
	 		for(var index = cursorPosition;index < tempStringArray.length;index++){
				tempString += tempStringArray[index];
				tempString += ",";					
	 		}
			cursorPosition += 1;    
			if(tempString.endsWith(",")){
				tempString = tempString.substring(0,tempString.length - 1);
			}
			editGlyph = tempString;				
			redraw();
	}
	
	function redraw(){
	    canvas = document.getElementById("editGlyphDisplay");
        readonlycanvas = document.getElementById("readonlyGlyphDisplay");
        spellcanvas = document.getElementById("glyphSpellingDisplay");
		buttoncanvas0 = document.getElementById("buttoncanvas0");
	    buttoncanvas1 = document.getElementById("buttoncanvas1");
	    buttoncanvas2 = document.getElementById("buttoncanvas2");
	    buttoncanvas3 = document.getElementById("buttoncanvas3");
	    buttoncanvas4 = document.getElementById("buttoncanvas4");
	    buttoncanvas5 = document.getElementById("buttoncanvas5");
	    buttoncanvas6 = document.getElementById("buttoncanvas6");
	    buttoncanvas7 = document.getElementById("buttoncanvas7");
	    buttoncanvas8 = document.getElementById("buttoncanvas8");
	    buttoncanvas9 = document.getElementById("buttoncanvas9");
		buttoncanvas10 = document.getElementById("buttoncanvas10");
	    buttoncanvas11 = document.getElementById("buttoncanvas11");
	    buttoncanvas12 = document.getElementById("buttoncanvas12");
	    buttoncanvas13 = document.getElementById("buttoncanvas13");
	    buttoncanvas14 = document.getElementById("buttoncanvas14");
	    buttoncanvas15 = document.getElementById("buttoncanvas15");
	    buttoncanvas16 = document.getElementById("buttoncanvas16");
	    buttoncanvas17 = document.getElementById("buttoncanvas17");
	    buttoncanvas18 = document.getElementById("buttoncanvas18");
	    buttoncanvas19 = document.getElementById("buttoncanvas19");
		buttoncanvas20 = document.getElementById("buttoncanvas20");
	    buttoncanvas21 = document.getElementById("buttoncanvas21");
	    buttoncanvas22 = document.getElementById("buttoncanvas22");
	    buttoncanvas23 = document.getElementById("buttoncanvas23");
	    buttoncanvas24 = document.getElementById("buttoncanvas24");
	    buttoncanvas25 = document.getElementById("buttoncanvas25");
	    buttoncanvas26 = document.getElementById("buttoncanvas26");
	    buttoncanvas27 = document.getElementById("buttoncanvas27");
	    buttoncanvas28 = document.getElementById("buttoncanvas28");
	    buttoncanvas29 = document.getElementById("buttoncanvas29");
		buttoncanvas30 = document.getElementById("buttoncanvas30");
	    buttoncanvas31 = document.getElementById("buttoncanvas31");
	    buttoncanvas32 = document.getElementById("buttoncanvas32");
	    buttoncanvas33 = document.getElementById("buttoncanvas33");
	    buttoncanvas34 = document.getElementById("buttoncanvas34");
	    buttoncanvas35 = document.getElementById("buttoncanvas35");
	    buttoncanvas36 = document.getElementById("buttoncanvas36");
	    buttoncanvas37 = document.getElementById("buttoncanvas37");
	    buttoncanvas38 = document.getElementById("buttoncanvas38");
	    buttoncanvas39 = document.getElementById("buttoncanvas39");


		
		if(backgroundImageOn){
		ctx = canvas.getContext("2d");
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		canvas.height = Number(currentImageHeight);
		canvas.width = Number(currentImageWidth);
  	    img = new Image();
 	    img.onload = function() {
 	    		ctx = canvas.getContext("2d");
     	 		ctx.drawImage(img, 0, 0);
     	 		ctx.font="30px Arial";
				ctx.fillText("0" + editAddress.toString(8),5,35);
				doTheThing(0300);
				drawGlyph(editGlyph);					drawGlyph("0342,0334,0342,0335,0335,0342,0334,0337,0330,0340,0331,0336,0336,0330,0340,0331,0337");//cursor
 
 	    };
   	    img.src = currentImageURL;
 	    }
 	    
 	    else{

 	    ctx = canvas.getContext("2d");
		ctx.clearRect(0, 0, canvas.width, canvas.height);

		ctx.font="30px Arial";
		ctx.fillText("0" + editAddress.toString(8),5,35);
		doTheThing(0300);
		drawGlyph(editGlyph);		drawGlyph("0342,0334,0342,0335,0335,0342,0334,0337,0330,0340,0331,0336,0336,0330,0340,0331,0337");//cursor
		}
		
		ctx = spellcanvas.getContext("2d");
		ctx.clearRect(0, 0, spellcanvas.width, spellcanvas.height);
		doTheThing(0300);
		side = 38;
		x = 2;
		y = 40;
		spellGlyph(editGlyph);
		x = 2 + cursorPosition*side;
		y += 2;
		doTheThing(0340);
		
		
		
		buildButton(buttoncanvas0,0);
		buildButton(buttoncanvas1,1);
		buildButton(buttoncanvas2,2);
		buildButton(buttoncanvas3,3);
		buildButton(buttoncanvas4,4);
		buildButton(buttoncanvas5,5);
		buildButton(buttoncanvas6,6);
		buildButton(buttoncanvas7,7);
		buildButton(buttoncanvas8,8);
		buildButton(buttoncanvas9,9);
		buildButton(buttoncanvas10,10);
		buildButton(buttoncanvas11,11);
		buildButton(buttoncanvas12,12);
		buildButton(buttoncanvas13,13);
		buildButton(buttoncanvas14,14);
		buildButton(buttoncanvas15,15);
		buildButton(buttoncanvas16,16);
		buildButton(buttoncanvas17,17);
		buildButton(buttoncanvas18,18);
		buildButton(buttoncanvas19,19);
		buildButton(buttoncanvas20,20);
		buildButton(buttoncanvas21,21);
		buildButton(buttoncanvas22,22);
		buildButton(buttoncanvas23,23);
		buildButton(buttoncanvas24,24);
		buildButton(buttoncanvas25,25);
		buildButton(buttoncanvas26,26);
		buildButton(buttoncanvas27,27);
		buildButton(buttoncanvas28,28);
		buildButton(buttoncanvas29,29);

		buildButton(buttoncanvas30,30);
		buildButton(buttoncanvas31,31);
		buildButton(buttoncanvas32,32);
		buildButton(buttoncanvas33,33);
		buildButton(buttoncanvas34,34);
		buildButton(buttoncanvas35,35);
		buildButton(buttoncanvas36,36);
		buildButton(buttoncanvas37,37);
		buildButton(buttoncanvas38,38);
		buildButton(buttoncanvas39,39);
 }   	
 
 function buildButton(localCanvas,localIndex){
 		ctx = localCanvas.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;		
		spellGlyph(addressStringArray[localIndex]);
 }	 
</script>

</body>
</html>