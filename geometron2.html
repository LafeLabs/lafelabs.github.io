<!DOCTYPE html>
<html>
<head>
	<title>Geometron: Geometry Based Meta-Language</title>
<script src="libraries/geometron2library.js"></script>
</head>
<body onkeydown = "keystrokeEvent(event)">

<script>
	initGeometron();
</script>


<canvas id="editGlyphDisplay" width="400" height="400"style="border:1px solid;">
</canvas>
<canvas id="readonlyGlyphDisplay" width="400" height="400"style="border:1px solid;">
</canvas>
<p>
<canvas onClick = "buttonEvent(0330)" id="buttoncanvas0" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0331)" id="buttoncanvas1" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0332)" id="buttoncanvas2" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0333)" id="buttoncanvas3" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0334)" id="buttoncanvas4" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0335)" id="buttoncanvas5" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0336)" id="buttoncanvas6" width="40" height="40"style="border:1px solid;">
</canvas>
<canvas onClick = "buttonEvent(0337)" id="buttoncanvas7" width="40" height="40"style="border:1px solid;">
</canvas>
<p>

<p>
<canvas id="glyphSpellingDisplay" width="800" height="80"style="border:1px solid;">
</canvas>
<p>

<script>
	redraw();
	
	function buttonEvent(localCommand){
	      	var tempCommandString = "0" + localCommand.toString(8); 
			var tempString = "";
	 		var tempStringArray = editGlyph.split(",");
	 		if(cursorPosition > tempStringArray.length){
	 			cursorPosition = tempStringArray.length;
	 		}
	 		for(var index = 0;index < cursorPosition;index++){
				tempString += tempStringArray[index];
				tempString += ",";
	 		}
			tempString += tempCommandString; 		
			tempString += ",";
	 		for(var index = cursorPosition;index < tempStringArray.length;index++){
				tempString += tempStringArray[index];
				tempString += ",";					
	 		}
			cursorPosition += 1;    
			if(tempString.endsWith(",")){
				tempString = tempString.substring(0,tempString.length - 1);
			}
			editGlyph = tempString;					
			redraw();
	}
	
	function keystrokeEvent(event){
		var x = event.which || event.keyCode; 
	//	y = x.toString();		
		if(x == 39){//right
			cursorPosition++;
			var tempStringArray = editGlyph.split(",");
			if(cursorPosition > tempStringArray.length){
				cursorPosition = tempStringArray.length;
			}
		}
		if(x == 37){//left
			cursorPosition--;
			if(cursorPosition < 0){
				cursorPosition = 0;
			}
		}
		if(x == 38){//up arrow decrements value of editAddress
			var oldEditAddress = editAddress;
			editAddress--;
			var oldEditGlyph = editGlyph;
			for(var index = 0;index < currentTable.length;index ++){
				var tempArray = currentTable[index].split(":")
				if(parseInt(tempArray[0],8) == editAddress){
					editGlyph = tempArray[1];					
				}
				if(parseInt(tempArray[0],8) == oldEditAddress){
					currentTable[index] = "0" + oldEditAddress.toString(8) + ":" + oldEditGlyph;					
				}
			}
			var tempStringArray = editGlyph.split(",");
			cursorPosition = tempStringArray.length;
		}
		if(x == 40){//down arrow increments value of editAddress
 			var oldEditAddress = editAddress;
 			editAddress++;
			var oldEditGlyph = editGlyph;
			for(var index = 0;index < currentTable.length;index++){
				var tempArray = currentTable[index].split(":")
				if(parseInt(tempArray[0],8) == editAddress){
					editGlyph = tempArray[1];					
				}
				if(parseInt(tempArray[0],8) == oldEditAddress){
					currentTable[index] = "0" + oldEditAddress.toString(8) + ":" + oldEditGlyph;					
				}
			}
			var tempStringArray = editGlyph.split(",");
			cursorPosition = tempStringArray.length;
 		}
		if(x == 8){//delete

    		var tempCommandString = "0" + currentKeyCommand.toString(8); 
			var tempString = "";
	 		var tempStringArray = editGlyph.split(",");
	 		for(var index = 0;index < cursorPosition - 1;index++){
				tempString += tempStringArray[index];
				tempString += ",";
	 		}

	 		for(var index = cursorPosition;index < tempStringArray.length;index++){
				tempString += tempStringArray[index];
				tempString += ",";					
	 		}
			cursorPosition -= 1;    
			if(tempString.endsWith(",")){
				tempString = tempString.substring(0,tempString.length - 1);
			}
			editGlyph = tempString;					

		}

	    keyString = "1230yuqwertasdfghjkl;zxcvbnm,";
  keyAddresses = [0304,0305,0306,0300,0336,0337,0310,0311,0312,0313,0314,0330,0331,0332,0333,0334,0335,0350,0351,0352,0353,0340,0341,0342,0343,0344,0345,0346,0347];
		y = String.fromCharCode(x);
		y = y.toLowerCase();
		//console.log(y);
		currentKeyCommand = -1;		
		for(var i = 0;i < keyString.length;i++){
			if(y == keyString.charAt(i)){
	    		currentKeyCommand = keyAddresses[i];
			}
    	}		
    	if(currentKeyCommand > 0){    	
    		var tempCommandString = "0" + currentKeyCommand.toString(8); 
			var tempString = "";
	 		var tempStringArray = editGlyph.split(",");
	 		if(cursorPosition > tempStringArray.length){
	 			cursorPosition = tempStringArray.length;
	 		}
	 		for(var index = 0;index < cursorPosition;index++){
				tempString += tempStringArray[index];
				tempString += ",";
	 		}
			tempString += tempCommandString; 		
			tempString += ",";
	 		for(var index = cursorPosition;index < tempStringArray.length;index++){
				tempString += tempStringArray[index];
				tempString += ",";					
	 		}
			cursorPosition += 1;    
			if(tempString.endsWith(",")){
				tempString = tempString.substring(0,tempString.length - 1);
			}
			editGlyph = tempString;					
		}
		console.log(editGlyph);
        redraw();
	}
	
	
	function redraw(){
	    canvas = document.getElementById("editGlyphDisplay");
        readonlycanvas = document.getElementById("readonlyGlyphDisplay");
        spellcanvas = document.getElementById("glyphSpellingDisplay");
		buttoncanvas0 = document.getElementById("buttoncanvas0");
	    buttoncanvas1 = document.getElementById("buttoncanvas1");
	    buttoncanvas2 = document.getElementById("buttoncanvas2");
	    buttoncanvas3 = document.getElementById("buttoncanvas3");
	    buttoncanvas4 = document.getElementById("buttoncanvas4");
	    buttoncanvas5 = document.getElementById("buttoncanvas5");
	    buttoncanvas6 = document.getElementById("buttoncanvas6");
	    buttoncanvas7 = document.getElementById("buttoncanvas7");

		
		ctx = canvas.getContext("2d");
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		ctx.font="30px Arial";
		ctx.fillText("0" + editAddress.toString(8),5,35);
		doTheThing(0300);
		drawGlyph(editGlyph);		drawGlyph("0342,0334,0342,0335,0335,0342,0334,0337,0330,0340,0331,0336,0336,0330,0340,0331,0337");
		
		ctx = readonlycanvas.getContext("2d");
		ctx.clearRect(0, 0, readonlycanvas.width, readonlycanvas.height);
		ctx.font="30px Arial";
		ctx.fillText("0" + readAddress.toString(8),5,35);
		drawGlyph(readGlyph);
		//draw readonly glyph
		
		ctx = spellcanvas.getContext("2d");
		ctx.clearRect(0, 0, spellcanvas.width, spellcanvas.height);
		side = 38;
		x = 2;
		y = 40;
		spellGlyph(editGlyph);
		x = 2 + cursorPosition*side;
		y += 2;
		doTheThing(0340);
		
		ctx = buttoncanvas0.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0330");
		ctx = buttoncanvas1.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0331");
		ctx = buttoncanvas2.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0332");
		ctx = buttoncanvas3.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0333");
		ctx = buttoncanvas4.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0334");
		ctx = buttoncanvas5.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0335");
		ctx = buttoncanvas6.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0336");
		ctx = buttoncanvas7.getContext("2d");
		ctx.clearRect(0, 0, buttoncanvas1.width, buttoncanvas1.height);
		side = 38;
		x = 2;
		y = 39;
		spellGlyph("0337");

 }   	
	 
</script>

</body>
</html>